<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Somlink Camera</title>
<style>
  body {
    margin: 0;
    overflow: hidden;
    background: black;
  }

  video#camera {
    position: fixed;
    width: 100%;
    height: 100%;
    object-fit: cover;
    z-index: 1;
  }

  .controls {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 20px;
    z-index: 5; /* ‚úÖ kor u qaaday si la taaban karo */
  }

  button {
    background: rgba(255, 255, 255, 0.2);
    border: none;
    padding: 10px 15px;
    border-radius: 12px;
    color: white;
    font-size: 18px;
    cursor: pointer;
    backdrop-filter: blur(5px);
  }

  button:hover {
    background: rgba(255, 255, 255, 0.4);
  }

  #galleryPanel {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0, 0, 0, 0.95);
    display: none;
    flex-direction: column;
    z-index: 10;
    color: white;
    padding: 10px;
    overflow-y: auto;
  }

  #galleryGrid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 10px;
  }

  #galleryGrid div {
    position: relative;
  }

  #galleryGrid img,
  #galleryGrid video {
    width: 100%;
    border-radius: 8px;
  }

  .deleteBtn {
    position: absolute;
    top: 5px;
    right: 5px;
    background: rgba(255, 0, 0, 0.9);
    border: none;
    border-radius: 8px;
    color: white;
    font-size: 13px;
    padding: 4px 8px;
    cursor: pointer;
    z-index: 20;
  }

  .deleteBtn:hover {
    background: red;
  }

  .downloadBtn {
    position: absolute;
    bottom: 5px;
    right: 5px;
    background: rgba(0, 0, 0, 0.7);
    border: none;
    border-radius: 6px;
    color: white;
    font-size: 12px;
    padding: 3px 6px;
    cursor: pointer;
  }

  .downloadBtn:hover {
    background: black;
  }

</style>
</head>
<body>

<video id="camera" autoplay playsinline></video>

<div class="controls">
  <button id="captureBtn">üì∏ Capture</button>
  <button id="galleryBtn">üñºÔ∏è Gallery</button>
</div>

<div id="galleryPanel">
  <button onclick="closeGallery()">‚¨ÖÔ∏è Back</button>
  <div id="galleryGrid"></div>
</div>

<script>
const video = document.getElementById('camera');
const captureBtn = document.getElementById('captureBtn');
const galleryBtn = document.getElementById('galleryBtn');
const galleryPanel = document.getElementById('galleryPanel');
const galleryGrid = document.getElementById('galleryGrid');

// ‚úÖ camera run
navigator.mediaDevices.getUserMedia({ video: true, audio: false })
  .then(stream => video.srcObject = stream)
  .catch(err => alert('Camera Error: ' + err));

captureBtn.onclick = () => {
  const canvas = document.createElement('canvas');
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  const ctx = canvas.getContext('2d');
  ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
  const dataUrl = canvas.toDataURL('image/png');

  const photos = JSON.parse(localStorage.getItem('somlinkGallery') || '[]');
  photos.push({ type: 'photo', data: dataUrl });
  localStorage.setItem('somlinkGallery', JSON.stringify(photos));
  alert('‚úÖ Sawirka waa la qabtay oo waa la kaydiyay!');
};

galleryBtn.onclick = () => {
  galleryPanel.style.display = 'flex';
  loadGallery();
};

function closeGallery() {
  galleryPanel.style.display = 'none';
}

function loadGallery() {
  galleryGrid.innerHTML = '';
  const photos = JSON.parse(localStorage.getItem('somlinkGallery') || '[]');
  photos.forEach((item, i) => {
    const wrap = document.createElement('div');

    const del = document.createElement('button');
    del.textContent = 'üóëÔ∏è Delete';
    del.className = 'deleteBtn';
    del.onclick = () => {
      if (confirm('Ma hubtaa inaad tirayso sawirkan?')) {
        photos.splice(i, 1);
        localStorage.setItem('somlinkGallery', JSON.stringify(photos));
        loadGallery();
      }
    };
    wrap.appendChild(del);

    // ‚úÖ Download Button
    const down = document.createElement('button');
    down.textContent = '‚¨áÔ∏è Download';
    down.className = 'downloadBtn';
    down.onclick = () => {
      const link = document.createElement('a');
      link.href = item.data;
      link.download = 'SomlinkPhoto.png';
      link.click();
    };
    wrap.appendChild(down);

    const img = document.createElement('img');
    img.src = item.data;
    wrap.appendChild(img);

    galleryGrid.appendChild(wrap);
  });
}
</script>

</body>
</html>
