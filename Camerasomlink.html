<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Somlink AI Camera</title>
<style>
body { margin:0; background:black; color:white; font-family:sans-serif; overflow:hidden; }
video { width:100%; height:100%; object-fit:cover; position:absolute; top:0; left:0; z-index:1; pointer-events:none; }
#snapshot, #overlay { position:absolute; top:0; left:0; width:100%; height:100%; z-index:2; pointer-events:none; }
#flash { position:fixed; top:0; left:0; width:100%; height:100%; background:white; opacity:0; transition:opacity 0.2s; z-index:10; }

#controls { 
  position:fixed; 
  bottom:20px; 
  width:100%; 
  display:flex; 
  justify-content:center; 
  gap:20px; 
  z-index:20; /* ‚úÖ ka sarreeya video/canvas */
}
button { 
  background:rgba(0,0,0,0.6); 
  color:white; 
  border:none; 
  border-radius:50%; 
  padding:12px; 
  font-size:18px; 
  z-index:30;
}

#filtersMenu {
  position:fixed;
  right:20px;
  bottom:100px;
  display:none;
  flex-direction:column;
  gap:8px;
  background:rgba(0,0,0,0.85);
  padding:10px;
  border-radius:10px;
  z-index:25; /* ‚úÖ ka sarreeya video */
}
#filtersMenu.show { display:flex; animation:fadeIn .3s ease; }
@keyframes fadeIn { from{opacity:0; transform:translateY(10px);} to{opacity:1; transform:translateY(0);} }

#galleryPanel {
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  background:rgba(0,0,0,0.95);
  display:none;
  flex-direction:column;
  align-items:center;
  overflow-y:auto;
  z-index:50; /* ‚úÖ ugu sareeya */
}
#galleryPanel.show { display:flex; }
#galleryPanel h2 { margin:10px; }
#galleryGrid { display:flex; flex-wrap:wrap; gap:8px; justify-content:center; }
#galleryGrid div { position:relative; }
#galleryGrid img, #galleryGrid video { width:110px; height:110px; object-fit:cover; border-radius:10px; border:2px solid white; }
.deleteBtn { position:absolute; top:2px; right:2px; background:red; border:none; border-radius:50%; color:white; font-size:12px; width:20px; height:20px; }
#closeGallery { position:fixed; top:10px; right:10px; background:#ff0077; border-radius:50%; padding:10px; font-size:18px; z-index:60; }
</style>
</head>
<body>

<video id="camera" autoplay playsinline muted></video>
<canvas id="snapshot"></canvas>
<canvas id="overlay"></canvas>
<div id="flash"></div>

<div id="controls">
  <button id="flipBtn">üîÑ</button>
  <button id="filterBtn">üé®</button>
  <button id="captureBtn">üì∏</button>
  <button id="recordBtn">üé•</button>
  <button id="galleryBtn">üñºÔ∏è</button>
</div>

<div id="filtersMenu">
  <button data-filter="none">Normal</button>
  <button data-filter="grayscale(1)">Grayscale</button>
  <button data-filter="sepia(1)">Sepia</button>
  <button data-filter="brightness(1.4) contrast(1.2)">Bright</button>
  <button data-filter="contrast(1.3) saturate(1.3)">Vivid</button>
  <button data-filter="blur(2px)">Soft</button>
</div>

<div id="galleryPanel">
  <button id="closeGallery">‚úñ</button>
  <h2>üì∑ My Gallery</h2>
  <div id="galleryGrid"></div>
</div>

<script>
const video = document.getElementById('camera');
const canvas = document.getElementById('snapshot');
const overlay = document.getElementById('overlay');
const ctx = canvas.getContext('2d');
const flash = document.getElementById('flash');
let useFront = true;
let currentFilter = 'none';
let stream;
let mediaRecorder, recordedChunks = [];
let isRecording = false;

async function startCamera() {
  if (stream) stream.getTracks().forEach(t => t.stop());
  try {
    stream = await navigator.mediaDevices.getUserMedia({
      video: { facingMode: useFront ? 'user' : 'environment', width: { ideal: 1280 }, height: { ideal: 720 } },
      audio: true
    });
    video.srcObject = stream;
    video.muted = true;
  } catch (e) {
    alert('Camera error: ' + e.message);
  }
}
startCamera();

document.getElementById('flipBtn').onclick = () => { useFront = !useFront; startCamera(); };

const filtersMenu = document.getElementById('filtersMenu');
document.getElementById('filterBtn').onclick = () => filtersMenu.classList.toggle('show');
filtersMenu.querySelectorAll('button').forEach(btn => {
  btn.onclick = () => {
    currentFilter = btn.dataset.filter;
    video.style.filter = currentFilter;
    filtersMenu.classList.remove('show');
  };
});

function flashEffect() {
  flash.style.opacity = 0.8;
  setTimeout(() => flash.style.opacity = 0, 200);
}

document.getElementById('captureBtn').onclick = () => {
  flashEffect();
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  ctx.filter = currentFilter;
  ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
  const imgData = canvas.toDataURL('image/png');
  const gal = JSON.parse(localStorage.getItem('somlinkGallery') || '[]');
  gal.push({ type: 'photo', data: imgData });
  localStorage.setItem('somlinkGallery', JSON.stringify(gal));
  alert('üì∏ Photo saved!');
};

document.getElementById('recordBtn').onclick = () => {
  if (!isRecording) startRecord(); else stopRecord();
};

function startRecord() {
  mediaRecorder = new MediaRecorder(stream);
  recordedChunks = [];
  mediaRecorder.ondataavailable = e => recordedChunks.push(e.data);
  mediaRecorder.onstop = saveVideo;
  mediaRecorder.start();
  isRecording = true;
  document.getElementById('recordBtn').textContent = '‚èπÔ∏è';
}

function stopRecord() {
  mediaRecorder.stop();
  isRecording = false;
  document.getElementById('recordBtn').textContent = 'üé•';
}

function saveVideo() {
  const blob = new Blob(recordedChunks, { type: 'video/webm' });
  const url = URL.createObjectURL(blob);
  const gal = JSON.parse(localStorage.getItem('somlinkGallery') || '[]');
  gal.push({ type: 'video', data: url });
  localStorage.setItem('somlinkGallery', JSON.stringify(gal));
  alert('üéûÔ∏è Video saved!');
}

const galleryPanel = document.getElementById('galleryPanel');
const galleryGrid = document.getElementById('galleryGrid');
document.getElementById('galleryBtn').onclick = () => { loadGallery(); galleryPanel.classList.add('show'); };
document.getElementById('closeGallery').onclick = () => galleryPanel.classList.remove('show');

function loadGallery() {
  galleryGrid.innerHTML = '';
  const gal = JSON.parse(localStorage.getItem('somlinkGallery') || '[]');
  gal.forEach((item, i) => {
    const wrap = document.createElement('div');
    const del = document.createElement('button');
    del.textContent = '‚úñ';
    del.className = 'deleteBtn';
    del.onclick = () => {
      gal.splice(i, 1);
      localStorage.setItem('somlinkGallery', JSON.stringify(gal));
      loadGallery();
    };
    wrap.appendChild(del);
    if (item.type === 'photo') {
      const img = document.createElement('img');
      img.src = item.data;
      wrap.appendChild(img);
    } else {
      const vid = document.createElement('video');
      vid.src = item.data;
      vid.controls = true;
      wrap.appendChild(vid);
    }
    galleryGrid.appendChild(wrap);
  });
}
</script>
</body>
    </html>
