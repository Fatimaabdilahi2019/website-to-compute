<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Snapchat-style Camera</title>
<style>
  html, body { margin:0; padding:0; width:100%; height:100%; overflow:hidden; background:black; font-family:sans-serif;}
  #app { position:relative; width:100vw; height:100vh; overflow:hidden; }

  video {
    position:absolute; top:0; left:0;
    width:100%; height:100%;
    object-fit:cover;
    z-index:1;
    background:#000;
    transform-origin:center center;
  }

  #overlay {
    position:absolute; top:0; left:0;
    width:100%; height:100%;
    z-index:2;
    pointer-events:none;
  }

  button {
    width:50px; height:50px; border-radius:50%; border:none;
    background: rgba(255,6,110,0.2); color:#fff; font-size:18px;
    display:flex; align-items:center; justify-content:center;
    box-shadow:0 6px 18px rgba(0,0,0,0.45); cursor:pointer;
    -webkit-tap-highlight-color:transparent;
  }

  button.small { width:36px; height:36px; font-size:14px; border-radius:12px; }

  .top-right { position:absolute; top:16px; right:14px; display:flex; flex-direction:column; gap:10px; z-index:999; }
  .bottom-center { position:absolute; bottom:18px; left:0; right:0; display:flex; justify-content:center; gap:12px; z-index:999; }

  #filtersMenu {
    position:absolute; right:20px; bottom:70px; display:flex; flex-direction:column; gap:8px;
    background:rgba(0,0,0,0.8); padding:10px; border-radius:10px;
    opacity:0; pointer-events:none; transition:0.3s ease;
    z-index:1000;
  }
  #filtersMenu.show { opacity:1; pointer-events:auto; }

  #gallery { position:absolute; top:20px; left:20px; display:flex; flex-direction:column; gap:10px; max-height:50vh; overflow-y:auto; z-index:1000;}
  #gallery img, #gallery video { width:100px; border-radius:8px; border:2px solid white; }

  #flash { position:absolute; top:0; left:0; width:100%; height:100%; background:white; opacity:0; pointer-events:none; z-index:998; transition:0.2s ease;}
</style>
</head>
<body>
<div id="app">
  <video id="video" autoplay playsinline></video>
  <canvas id="overlay"></canvas>

  <div class="top-right">
    <button id="flipBtn" class="small" title="Flip">üîÑ</button>
    <button id="flashBtn" class="small" title="Flash">‚ö°</button>
  </div>

  <div class="bottom-center">
    <button id="filtersBtn" title="Filters">üé®</button>
    <button id="captureBtn" title="Capture">üì∏</button>
    <button id="recordBtn" title="Record">‚è∫Ô∏è</button>
    <button id="galleryBtn" title="Gallery">üñºÔ∏è</button>
  </div>

  <div id="filtersMenu">
    <button data-filter="none">Normal</button>
    <button data-filter="grayscale(100%)">Grayscale</button>
    <button data-filter="sepia(100%)">Sepia</button>
    <button data-filter="brightness(1.2) contrast(1.1) saturate(1.3)">Bright & Soft</button>
    <button data-filter="contrast(1.2) saturate(1.1) hue-rotate(200deg)">Cool / Blue</button>
    <button data-filter="contrast(1.1) saturate(1.2) hue-rotate(30deg)">Warm / Orange</button>
    <button data-filter="contrast(0.9) brightness(1.1) sepia(0.5)">Vintage / Retro</button>
  </div>

  <div id="gallery"></div>
  <div id="flash"></div>
</div>

<script>
const video = document.getElementById('video');
const overlay = document.getElementById('overlay');
const flash = document.getElementById('flash');

const flipBtn = document.getElementById('flipBtn');
const flashBtn = document.getElementById('flashBtn');
const captureBtn = document.getElementById('captureBtn');
const recordBtn = document.getElementById('recordBtn');
const filtersBtn = document.getElementById('filtersBtn');
const filtersMenu = document.getElementById('filtersMenu');
const gallery = document.getElementById('gallery');

let useFront = true;
let currentFilter = 'none';
let mediaRecorder, recordedChunks=[], isRecording=false;

// Start camera
async function startCamera() {
  if(video.srcObject) video.srcObject.getTracks().forEach(t=>t.stop());
  const constraints = {
    video:{ facingMode: useFront ? 'user':'environment', width:{ideal:window.innerWidth}, height:{ideal:window.innerHeight}, aspectRatio:window.innerWidth/window.innerHeight },
    audio:false
  };
  try {
    const stream = await navigator.mediaDevices.getUserMedia(constraints);
    video.srcObject = stream;
    video.style.transform = useFront ? 'scaleX(-1)' : 'scaleX(1)';
    overlay.style.transform = video.style.transform;
    video.onloadedmetadata = ()=>{ overlay.width=video.videoWidth; overlay.height=video.videoHeight; };
  } catch(e){ alert('Camera access failed: '+e.message); }
}

// Flip camera
flipBtn.onclick = ()=>{ useFront = !useFront; startCamera(); }

// Flash effect
flashBtn.onclick = ()=>{ flash.style.opacity=0.8; setTimeout(()=>flash.style.opacity=0,100); }

// Filters toggle
filtersBtn.onclick = ()=>{ filtersMenu.classList.toggle('show'); }
filtersMenu.querySelectorAll('button').forEach(btn=>{
  btn.onclick=()=>{
    currentFilter = btn.dataset.filter;
    video.style.filter = currentFilter;
    filtersMenu.classList.remove('show');
  }
});

// Take photo
captureBtn.onclick = ()=>{
  flashBtn.onclick(); // Flash
  const canvas = document.createElement('canvas');
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  const ctx = canvas.getContext('2d');
  ctx.filter = currentFilter;
  ctx.drawImage(video,0,0);
  const dataURL = canvas.toDataURL('image/png');

  // Save locally
  let photos = JSON.parse(localStorage.getItem('snapPhotos')||'[]');
  photos.push({type:'photo', data:dataURL});
  localStorage.setItem('snapPhotos', JSON.stringify(photos));

  loadGallery();
}

// Video record
recordBtn.onclick = ()=>{
  if(!isRecording) startRecording(); else stopRecording();
}
function startRecording(){
  recordedChunks=[];
  mediaRecorder = new MediaRecorder(video.srcObject,{mimeType:'video/webm; codecs=vp8,opus'});
  mediaRecorder.ondataavailable = e=>{ if(e.data.size>0) recordedChunks.push(e.data); };
  mediaRecorder.onstop = saveVideo;
  mediaRecorder.start();
  isRecording=true;
  recordBtn.textContent="‚èπÔ∏è";
}
function stopRecording(){
  if(mediaRecorder && mediaRecorder.state!=="inactive"){ mediaRecorder.stop(); isRecording=false; recordBtn.textContent="‚è∫Ô∏è"; }
}
function saveVideo(){
  const blob = new Blob(recordedChunks,{type:'video/webm'});
  const url = URL.createObjectURL(blob);
  let photos = JSON.parse(localStorage.getItem('snapPhotos')||'[]');
  photos.push({type:'video', data:url});
  localStorage.setItem('snapPhotos', JSON.stringify(photos));
  loadGallery();
}

// Gallery
function loadGallery(){
  gallery.innerHTML='';
  const photos = JSON.parse(localStorage.getItem('snapPhotos')||'[]');
  photos.forEach(item=>{
    if(item.type==='photo'){ const img = document.createElement('img'); img.src=item.data; gallery.appendChild(img);}
    else if(item.type==='video'){ const vid=document.createElement('video'); vid.src=item.data; vid.controls=true; gallery.appendChild(vid);}
  });
}

// Init
startCamera();
loadGallery();
</script>
</body>
  </html>
